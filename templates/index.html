<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://spil.co.id/img/spil_logo.581f4306.svg" type="image/x-icon">
    <title>SPIL | Ships Crew Recommendation</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

    <style>
        h1 {
            text-align: center;
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 40px;
            background-color: rgb(41, 104, 46, 0.9);
        }

        h5 {
            color: white;
            padding: 12px;
            margin-bottom: 24px;
            border-radius: 8px;
            background-color: rgba(56, 139, 63, 0.75);
        }

        .plabel {
            display: flex;
            align-items: center;
            padding-top: 8px !important;
        }

        div.mb-2.row {
            width: 334px !important;
        }

        col {
            width: min-content !important;
            min-width: min-content !important;
            max-width: min-content !important;
        }

        .col-sm-1 {
            min-width: 120px !important;
        }

        .col-sm-2 {
            width: 214px !important;
        }

        .btns {
            padding: 8px 16px !important;
        }

        .plusForm {
            padding: 6px 12px !important;
        }
    </style>
</head>

<body>
    <div class="container mt-4 mb-4 pt-4 pb-2">
        <h1>Ships Crew Recommendation</h1>
        <div>
            <h5>Input</h5>
        </div>
        <div class="row" id="colsInput">
            <div class="col" style="flex: 0 0 0.5% !important;">
                <div class="mb-2 row">
                    <label for="genderInput1" class="form-label col-sm-1 plabel">Gender</label>
                    <div class="col-sm-2">
                        <select class="form-select" id="genderInput1" required>
                            <option selected hidden>Gender</option>
                            <option value="PRIA">Pria</option>
                            <option value="WANITA">Wanita</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2 row">
                    <label for="ageInput1" class="form-label col-sm-1 plabel">Age</label>
                    <div class="col-sm-2">
                        <input type="number" class="form-control" id="ageInput1" min="0" step="1" value="22" required>
                    </div>
                </div>
                <div class="mb-2 row">
                    <label for="educationInput1" class="form-label col-sm-1 plabel">Education</label>
                    <div class="col-sm-2">
                        <select class="form-select" id="educationInput1" required>
                            <option selected hidden>Education Level</option>
                            <option value="SD">SD</option>
                            <option value="SMP">SMP</option>
                            <option value="SMA">SMA/SLTA/SMK</option>
                            <option value="D1">D1</option>
                            <option value="D2">D2</option>
                            <option value="D3">D3</option>
                            <option value="D4">D4</option>
                            <option value="S1">S1</option>
                            <option value="S2">S2</option>
                            <option value="S3">S3</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2 row">
                    <label for="statusInput1" class="form-label col-sm-1 plabel">Status</label>
                    <div class="col-sm-2">
                        <select class="form-select" id="statusInput1" required>
                            <option selected hidden>Status</option>
                            <option value="OFF">Off</option>
                            <option value="ON BOARD">On Board</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2 row">
                    <label for="experienceInput1" class="form-label col-sm-1 plabel">Experience</label>
                    <div class="col-sm-2">
                        <select class="form-select" id="experienceInput1" required>
                            <option selected hidden>Experience</option>
                            <option value="<3 BULAN">&lt; 3 Bulan</option>
                            <option value="3-6 BULAN">3-6 Bulan</option>
                            <option value="6-9 BULAN">6-9 Bulan</option>
                            <option value=">9 BULAN">&gt; 9 Bulan</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2 row">
                    <label for="certificateInput1" class="form-label col-sm-1 plabel">Certificate</label>
                    <div class="col-sm-2">
                        <select class="form-select" id="certificateInput1" required>
                            <option selected hidden>Certificate</option>
                            <option value="BASIC SAFETY TRAINING">BASIC SAFETY TRAINING</option>
                            <option value="ANT-D">ANT-D</option>
                            <option value="ATT-D">ATT-D</option>
                            <option value="ANT-V">ANT-V</option>
                            <option value="ATT-V">ATT-V</option>
                            <option value="ANT-IV">ANT-IV</option>
                            <option value="ATT-IV">ATT-IV</option>
                            <option value="ANT-III">ANT-III</option>
                            <option value="ATT-III">ATT-III</option>
                            <option value="ANT-II">ANT-II</option>
                            <option value="ATT-II">ATT-II</option>
                            <option value="ETR">ETR</option>
                            <option value="ANT-I">ANT-I</option>
                            <option value="ATT-I">ATT-I</option>
                            <option value="ETO">ETO</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2 row">
                    <label for="lastPosInput1" class="form-label col-sm-1 plabel">Last Position</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="lastPosInput1" value="Mualim III" placeholder="Last Position" required>
                    </div>
                </div>
            </div>
            <!-- Harus Ditambah disini jika button addInput ditekan -->
        </div>
        <div id="alert" style="padding: 12px 0px; margin: 0; display: none;">   
            <h6 style="color: red; padding: 0; margin: 0;">You can only enter a variety of data as input up to 5 data.
            </h6>
        </div>
    </div>

    <div class="container">
        <button id="btnRecommend" class="btn btn-success btns">Recommend Candidate</button>
        <button class="btn btn-secondary btns" id="addInput">Add Input</button>
    </div>

    <div id="loading" style="text-align: center; margin-top: 20px; display: none;">
        <div style="display: flex; align-items: center; justify-content: center;">
            <img src="https://www.amoudfoundation.org/wp-content/uploads/2020/07/loading-gif-png-5.gif" alt="Loading"
                style="margin-right: 10px;" width="28px">
            <div style="margin-top: 8px;">
                <h6>Loading data...</h6>
            </div>
        </div>
    </div>

    <div class="container mt-5 mb-4" id="results" style="display: none;">
        <div>
            <h5>Recommended Crew's</h5>
        </div>
        <table class="table table-striped mt-3" id="tableMains">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Similarity (%)</th>
                    <th>Full Name</th>
                    <th>Gender</th>
                    <th>Age</th>
                    <th>Education Level</th>
                    <th>Status</th>
                    <th>Experience</th>
                    <th>Certificate</th>
                    <th>Last Position</th>
                </tr>
            </thead>
            <tbody id="candidateRecommendationTable">
                <!-- Isi tabel disini -->
            </tbody>
        </table>
    </div>

    <div class="container mt-5 mb-5" id="results2" style="display: none;">
        <div>
            <h5>Recommended Crew's</h5>
        </div>
        <div style="text-align: center;">
            <p>We're sorry that we couldn't find the corresponding data in the current database, please correct or update your database, Thank you.</p>
        </div>
    </div>

    <footer style="bottom: 0; left: 0; width: 100%; margin-top: 80px;
        background-color: rgb(129, 129, 129); color: white; text-align: right;">
        <div style="display: flex; justify-content: flex-end; align-items: center; margin: 0; padding: 8px 10px;">
            <b><p style="margin: 0; font-size: 12px;">
                Present by HRIS Intern
            </p></b>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <script>
        let tableCount = 1
        document.getElementById('btnRecommend').addEventListener('click', function () {
            document.getElementById('loading').style.display = 'block'

            let data = []
            if (tableCount == 1) {
                var gender = document.getElementById('genderInput' + tableCount.toString()).value;
                var age = document.getElementById('ageInput' + tableCount.toString()).value;
                var status = document.getElementById('statusInput' + tableCount.toString()).value;
                var education = document.getElementById('educationInput' + tableCount.toString()).value;
                var experience = document.getElementById('experienceInput' + tableCount.toString()).value;
                var certificate = document.getElementById('certificateInput' + tableCount.toString()).value;
                var lastPos = document.getElementById('lastPosInput' + tableCount.toString()).value;

                data = [
                    {
                        "GENDER": gender,
                        "AGE": age,
                        "STATUS": status,
                        "EDU_LEVEL": education,
                        "EXPERIENCE": experience,
                        "CERTIFICATE": certificate,
                        "LAST_POSITION": lastPos
                    }
                ];
            } else {
                let data_member = {}
                for (let num = 1; num <= tableCount; num++) {
                    data_member = {
                        "GENDER": document.getElementById('genderInput' + num.toString()).value,
                        "AGE": document.getElementById('ageInput' + num.toString()).value,
                        "STATUS": document.getElementById('statusInput' + num.toString()).value,
                        "EDU_LEVEL": document.getElementById('educationInput' + num.toString()).value,
                        "EXPERIENCE": document.getElementById('experienceInput' + num.toString()).value,
                        "CERTIFICATE": document.getElementById('certificateInput' + num.toString()).value,
                        "LAST_POSITION": document.getElementById('lastPosInput' + num.toString()).value
                    }
                    data.push(data_member)
                }
                console.log(data)
            }

            fetch('/recommended_candidates', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none'
                    
                    if (data.length > 1) {
                        document.getElementById("results2").style.display = "none"
                        document.getElementById("results").style.display = "block"

                        let tableBody = document.getElementById("candidateRecommendationTable");
                        let rowHTML = "";
                        tableBody.innerHTML = "";

                        for (let i = 0; i < data.length; i++) {
                            const candidate = data[i];
                            rowHTML += `<tr>
                                    <td>${i + 1}</td>
                                    <td style="text-align: center;">${candidate["SIMILARITY (%)"]}</td>
                                    <td>${candidate["NAME"]}</td>
                                    <td style="text-align: center;">${candidate["GENDER"]}</td>
                                    <td style="text-align: center;">${candidate["AGE"]}</td>
                                    <td style="text-align: center;">${candidate["EDU_LEVEL"]}</td>
                                    <td style="text-align: center;">${candidate["STATUS"]}</td>
                                    <td style="text-align: center;">${candidate["EXPERIENCE"]}</td>
                                    <td style="text-align: center;">${candidate["CERTIFICATE"]}</td>
                                    <td>${candidate["LAST_POSITION"]}</td>
                                </tr>`;
                        }
                        tableBody.innerHTML = rowHTML;
                        $('#tableMains').DataTable();

                    } else {
                        document.getElementById("results").style.display = "none"
                        document.getElementById("results2").style.display = "block"
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        document.getElementById('addInput').addEventListener('click', function () {
            if (tableCount <= 4) {
                var divs = document.createElement('div');
                divs.className = "col";
                divs.style.flex = "0 0 0.5%";

                divs.innerHTML = `
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <select class="form-select plusForm" id="genderInput${tableCount + 1}">
                            <option selected hidden>Gender</option>
                            <option value="PRIA">Pria</option>
                            <option value="WANITA">Wanita</option>
                        </select>
                    </div>
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <input type="number" class="form-control plusForm" id="ageInput${tableCount + 1}" min="0" step="1">
                    </div>
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <select class="form-select plusForm" id="educationInput${tableCount + 1}">
                            <option selected hidden>Education Level</option>
                            <option value="SD">SD</option>
                            <option value="SMP">SMP</option>
                            <option value="SMA">SMA/SLTA/SMK</option>
                            <option value="D1">D1</option>
                            <option value="D2">D2</option>
                            <option value="D3">D3</option>
                            <option value="D4">D4</option>
                            <option value="S1">S1</option>
                            <option value="S2">S2</option>
                            <option value="S3">S3</option>
                        </select>
                    </div>
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <select class="form-select plusForm" id="statusInput${tableCount + 1}">
                            <option selected hidden>Status</option>
                            <option value="OFF">Off</option>
                            <option value="ON BOARD">On Board</option>
                        </select>
                    </div>
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <select class="form-select plusForm" id="experienceInput${tableCount + 1}">
                            <option selected hidden>Experience</option>
                            <option value="<3 BULAN">&lt; 3 Bulan</option>
                            <option value="3-6 BULAN">3-6 Bulan</option>
                            <option value="6-9 BULAN">6-9 Bulan</option>
                            <option value=">9 BULAN">&gt; 9 Bulan</option>
                        </select>
                    </div>
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <select class="form-select plusForm" id="certificateInput${tableCount + 1}">
                            <option selected hidden>Certificate</option>
                            <option value="BASIC SAFETY TRAINING">BASIC SAFETY TRAINING</option>
                            <option value="ANT-D">ANT-D</option>
                            <option value="ATT-D">ATT-D</option>
                            <option value="ANT-V">ANT-V</option>
                            <option value="ATT-V">ATT-V</option>
                            <option value="ANT-IV">ANT-IV</option>
                            <option value="ATT-IV">ATT-IV</option>
                            <option value="ANT-III">ANT-III</option>
                            <option value="ATT-III">ATT-III</option>
                            <option value="ANT-II">ANT-II</option>
                            <option value="ATT-II">ATT-II</option>
                            <option value="ETR">ETR</option>
                            <option value="ANT-I">ANT-I</option>
                            <option value="ATT-I">ATT-I</option>
                            <option value="ETO">ETO</option>
                        </select>
                    </div>
                    <div class="col-sm-2" style="margin-bottom: 10px">
                        <input type="text" class="form-control plusForm" id="lastPosInput${tableCount + 1}" placeholder="Last Position">
                    </div>
                `;

                var colsInput = document.getElementById('colsInput');
                colsInput.appendChild(divs);
            }

            if (tableCount <= 4) {
                tableCount++;
                document.getElementById("alert").style.display = "none";
            } else {
                document.getElementById("alert").style.display = "block";
            }
        });
    </script>
</body>

</html>